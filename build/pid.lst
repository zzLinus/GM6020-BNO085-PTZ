ARM GAS  /tmp/ccyOGIX2.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"pid.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "Core/Src/pid.c"
  20              		.section	.text.pid_param_init,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	pid_param_init:
  27              	.LVL0:
  28              	.LFB130:
   1:Core/Src/pid.c **** /**
   2:Core/Src/pid.c ****   ******************************************************************************
   3:Core/Src/pid.c ****   * @file    pid.c
   4:Core/Src/pid.c ****   * @author  Ginger
   5:Core/Src/pid.c ****   * @version V1.0.0
   6:Core/Src/pid.c ****   * @date    2015/11/14
   7:Core/Src/pid.c ****   * @brief   对每一个pid结构体都要先进行函数的连接，再进行初始化
   8:Core/Src/pid.c ****   ******************************************************************************
   9:Core/Src/pid.c ****   * @attention 应该是用二阶差分(d)云台会更加稳定
  10:Core/Src/pid.c ****   *
  11:Core/Src/pid.c ****   ******************************************************************************
  12:Core/Src/pid.c ****   */
  13:Core/Src/pid.c **** 
  14:Core/Src/pid.c **** /* Includes ------------------------------------------------------------------*/
  15:Core/Src/pid.c **** #include "pid.h"
  16:Core/Src/pid.c **** #include "stm32f4xx.h"
  17:Core/Src/pid.c **** 
  18:Core/Src/pid.c **** #define ABS(x)		((x>0)? x: -x) 
  19:Core/Src/pid.c **** 
  20:Core/Src/pid.c **** PID_TypeDef pid_pitch,pid_pithch_speed,pid_roll,pid_roll_speed,pid_yaw_speed;
  21:Core/Src/pid.c **** extern int isMove;
  22:Core/Src/pid.c **** 
  23:Core/Src/pid.c **** /*参数初始化--------------------------------------------------------------*/
  24:Core/Src/pid.c **** static void pid_param_init(
  25:Core/Src/pid.c **** 	PID_TypeDef * pid, 
  26:Core/Src/pid.c **** 	PID_ID   id,
  27:Core/Src/pid.c **** 	uint16_t maxout,
  28:Core/Src/pid.c **** 	uint16_t intergral_limit,
  29:Core/Src/pid.c **** 	float deadband,
  30:Core/Src/pid.c **** 	uint16_t period,
ARM GAS  /tmp/ccyOGIX2.s 			page 2


  31:Core/Src/pid.c **** 	int16_t  max_err,
  32:Core/Src/pid.c **** 	int16_t  target,
  33:Core/Src/pid.c **** 
  34:Core/Src/pid.c **** 	float 	kp, 
  35:Core/Src/pid.c **** 	float 	ki, 
  36:Core/Src/pid.c **** 	float 	kd)
  37:Core/Src/pid.c **** {
  29              		.loc 1 37 1 view -0
  30              		.cfi_startproc
  31              		@ args = 12, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
  34              		.loc 1 37 1 is_stmt 0 view .LVU1
  35 0000 07EE902A 		vmov	s15, r2	@ int
  36 0004 07EE103A 		vmov	s14, r3	@ int
  38:Core/Src/pid.c **** 	pid->id = id;		
  37              		.loc 1 38 2 is_stmt 1 view .LVU2
  38              		.loc 1 38 10 is_stmt 0 view .LVU3
  39 0008 0170     		strb	r1, [r0]
  39:Core/Src/pid.c **** 	
  40:Core/Src/pid.c **** 	pid->ControlPeriod = period;             //没用到
  40              		.loc 1 40 2 is_stmt 1 view .LVU4
  41              		.loc 1 40 21 is_stmt 0 view .LVU5
  42 000a BDF80030 		ldrh	r3, [sp]
  43              	.LVL1:
  44              		.loc 1 40 21 view .LVU6
  45 000e 06EE903A 		vmov	s13, r3	@ int
  46 0012 F8EE666A 		vcvt.f32.u32	s13, s13
  47 0016 C0ED116A 		vstr.32	s13, [r0, #68]
  41:Core/Src/pid.c **** 	pid->DeadBand = deadband;
  48              		.loc 1 41 2 is_stmt 1 view .LVU7
  49              		.loc 1 41 16 is_stmt 0 view .LVU8
  50 001a 80ED100A 		vstr.32	s0, [r0, #64]
  42:Core/Src/pid.c **** 	pid->IntegralLimit = intergral_limit;
  51              		.loc 1 42 2 is_stmt 1 view .LVU9
  52              		.loc 1 42 21 is_stmt 0 view .LVU10
  53 001e B8EE477A 		vcvt.f32.u32	s14, s14
  54              	.LVL2:
  55              		.loc 1 42 21 view .LVU11
  56 0022 80ED0F7A 		vstr.32	s14, [r0, #60]
  43:Core/Src/pid.c **** 	pid->MaxOutput = maxout;
  57              		.loc 1 43 2 is_stmt 1 view .LVU12
  58              		.loc 1 43 17 is_stmt 0 view .LVU13
  59 0026 F8EE677A 		vcvt.f32.u32	s15, s15
  60 002a C0ED0E7A 		vstr.32	s15, [r0, #56]
  44:Core/Src/pid.c **** 	pid->Max_Err = max_err;
  61              		.loc 1 44 2 is_stmt 1 view .LVU14
  62              		.loc 1 44 15 is_stmt 0 view .LVU15
  63 002e BDF90430 		ldrsh	r3, [sp, #4]
  64 0032 07EE903A 		vmov	s15, r3	@ int
  65 0036 F8EEE77A 		vcvt.f32.s32	s15, s15
  66 003a C0ED127A 		vstr.32	s15, [r0, #72]
  45:Core/Src/pid.c **** 	pid->target = target;
  67              		.loc 1 45 2 is_stmt 1 view .LVU16
  68              		.loc 1 45 14 is_stmt 0 view .LVU17
  69 003e BDF90830 		ldrsh	r3, [sp, #8]
  70 0042 07EE903A 		vmov	s15, r3	@ int
ARM GAS  /tmp/ccyOGIX2.s 			page 3


  71 0046 F8EEE77A 		vcvt.f32.s32	s15, s15
  72 004a C0ED017A 		vstr.32	s15, [r0, #4]
  46:Core/Src/pid.c **** 	
  47:Core/Src/pid.c **** 	pid->kp = kp;
  73              		.loc 1 47 2 is_stmt 1 view .LVU18
  74              		.loc 1 47 10 is_stmt 0 view .LVU19
  75 004e C0ED030A 		vstr.32	s1, [r0, #12]
  48:Core/Src/pid.c **** 	pid->ki = ki;
  76              		.loc 1 48 2 is_stmt 1 view .LVU20
  77              		.loc 1 48 10 is_stmt 0 view .LVU21
  78 0052 80ED041A 		vstr.32	s2, [r0, #16]
  49:Core/Src/pid.c **** 	pid->kd = kd;
  79              		.loc 1 49 2 is_stmt 1 view .LVU22
  80              		.loc 1 49 10 is_stmt 0 view .LVU23
  81 0056 C0ED051A 		vstr.32	s3, [r0, #20]
  50:Core/Src/pid.c **** 	
  51:Core/Src/pid.c **** 	pid->output = 0;
  82              		.loc 1 51 2 is_stmt 1 view .LVU24
  83              		.loc 1 51 14 is_stmt 0 view .LVU25
  84 005a 0023     		movs	r3, #0
  85 005c 0363     		str	r3, [r0, #48]	@ float
  52:Core/Src/pid.c **** }
  86              		.loc 1 52 1 view .LVU26
  87 005e 7047     		bx	lr
  88              		.cfi_endproc
  89              	.LFE130:
  91              		.section	.text.pid_reset,"ax",%progbits
  92              		.align	1
  93              		.syntax unified
  94              		.thumb
  95              		.thumb_func
  97              	pid_reset:
  98              	.LVL3:
  99              	.LFB131:
  53:Core/Src/pid.c **** 
  54:Core/Src/pid.c **** /*中途更改参数设定--------------------------------------------------------------*/
  55:Core/Src/pid.c **** static void pid_reset(PID_TypeDef * pid, float kp, float ki, float kd)
  56:Core/Src/pid.c **** {
 100              		.loc 1 56 1 is_stmt 1 view -0
 101              		.cfi_startproc
 102              		@ args = 0, pretend = 0, frame = 0
 103              		@ frame_needed = 0, uses_anonymous_args = 0
 104              		@ link register save eliminated.
  57:Core/Src/pid.c **** 	pid->kp = kp;
 105              		.loc 1 57 2 view .LVU28
 106              		.loc 1 57 10 is_stmt 0 view .LVU29
 107 0000 80ED030A 		vstr.32	s0, [r0, #12]
  58:Core/Src/pid.c **** 	pid->ki = ki;
 108              		.loc 1 58 2 is_stmt 1 view .LVU30
 109              		.loc 1 58 10 is_stmt 0 view .LVU31
 110 0004 C0ED040A 		vstr.32	s1, [r0, #16]
  59:Core/Src/pid.c **** 	pid->kd = kd;
 111              		.loc 1 59 2 is_stmt 1 view .LVU32
 112              		.loc 1 59 10 is_stmt 0 view .LVU33
 113 0008 80ED051A 		vstr.32	s2, [r0, #20]
  60:Core/Src/pid.c **** }
 114              		.loc 1 60 1 view .LVU34
ARM GAS  /tmp/ccyOGIX2.s 			page 4


 115 000c 7047     		bx	lr
 116              		.cfi_endproc
 117              	.LFE131:
 119              		.section	.text.circle_err,"ax",%progbits
 120              		.align	1
 121              		.global	circle_err
 122              		.syntax unified
 123              		.thumb
 124              		.thumb_func
 126              	circle_err:
 127              	.LVL4:
 128              	.LFB132:
  61:Core/Src/pid.c **** 
  62:Core/Src/pid.c **** /*pid计算-----------------------------------------------------------------------*/
  63:Core/Src/pid.c **** 
  64:Core/Src/pid.c **** //环形求差的计算(过零处理)
  65:Core/Src/pid.c **** int circle_err(int val_a, int val_b, int circle_len)
  66:Core/Src/pid.c **** {
 129              		.loc 1 66 1 is_stmt 1 view -0
 130              		.cfi_startproc
 131              		@ args = 0, pretend = 0, frame = 0
 132              		@ frame_needed = 0, uses_anonymous_args = 0
 133              		@ link register save eliminated.
  67:Core/Src/pid.c **** 	if(val_a-val_b > circle_len/2)
 134              		.loc 1 67 2 view .LVU36
 135              		.loc 1 67 10 is_stmt 0 view .LVU37
 136 0000 401A     		subs	r0, r0, r1
 137              	.LVL5:
 138              		.loc 1 67 29 view .LVU38
 139 0002 02EBD273 		add	r3, r2, r2, lsr #31
 140 0006 5910     		asrs	r1, r3, #1
 141              	.LVL6:
 142              		.loc 1 67 4 view .LVU39
 143 0008 B0EB630F 		cmp	r0, r3, asr #1
 144 000c 03DC     		bgt	.L6
  68:Core/Src/pid.c **** 	{
  69:Core/Src/pid.c **** 		return (val_a-val_b) - circle_len;
  70:Core/Src/pid.c **** 	}
  71:Core/Src/pid.c **** 	if(val_a-val_b < -circle_len/2)
 145              		.loc 1 71 2 is_stmt 1 view .LVU40
 146              		.loc 1 71 4 is_stmt 0 view .LVU41
 147 000e 4942     		rsbs	r1, r1, #0
 148 0010 8842     		cmp	r0, r1
 149 0012 02DB     		blt	.L7
 150              	.L3:
  72:Core/Src/pid.c **** 	{
  73:Core/Src/pid.c **** 		return circle_len + (val_a-val_b);
  74:Core/Src/pid.c **** 	}
  75:Core/Src/pid.c **** 	return val_a - val_b;
  76:Core/Src/pid.c **** }
 151              		.loc 1 76 1 view .LVU42
 152 0014 7047     		bx	lr
 153              	.L6:
  69:Core/Src/pid.c **** 	}
 154              		.loc 1 69 3 is_stmt 1 view .LVU43
  69:Core/Src/pid.c **** 	}
 155              		.loc 1 69 24 is_stmt 0 view .LVU44
ARM GAS  /tmp/ccyOGIX2.s 			page 5


 156 0016 801A     		subs	r0, r0, r2
 157 0018 7047     		bx	lr
 158              	.L7:
  73:Core/Src/pid.c **** 	}
 159              		.loc 1 73 3 is_stmt 1 view .LVU45
  73:Core/Src/pid.c **** 	}
 160              		.loc 1 73 21 is_stmt 0 view .LVU46
 161 001a 1044     		add	r0, r0, r2
 162 001c FAE7     		b	.L3
 163              		.cfi_endproc
 164              	.LFE132:
 166              		.section	.text.pid_calculate,"ax",%progbits
 167              		.align	1
 168              		.syntax unified
 169              		.thumb
 170              		.thumb_func
 172              	pid_calculate:
 173              	.LVL7:
 174              	.LFB133:
  77:Core/Src/pid.c **** 	
  78:Core/Src/pid.c **** 	
  79:Core/Src/pid.c **** static float pid_calculate(PID_TypeDef* pid, float measure, int circle_len)//, int16_t target)
  80:Core/Src/pid.c **** {
 175              		.loc 1 80 1 is_stmt 1 view -0
 176              		.cfi_startproc
 177              		@ args = 0, pretend = 0, frame = 0
 178              		@ frame_needed = 0, uses_anonymous_args = 0
 179              		.loc 1 80 1 is_stmt 0 view .LVU48
 180 0000 38B5     		push	{r3, r4, r5, lr}
 181              	.LCFI0:
 182              		.cfi_def_cfa_offset 16
 183              		.cfi_offset 3, -16
 184              		.cfi_offset 4, -12
 185              		.cfi_offset 5, -8
 186              		.cfi_offset 14, -4
 187 0002 2DED048B 		vpush.64	{d8, d9}
 188              	.LCFI1:
 189              		.cfi_def_cfa_offset 32
 190              		.cfi_offset 80, -32
 191              		.cfi_offset 81, -28
 192              		.cfi_offset 82, -24
 193              		.cfi_offset 83, -20
 194 0006 0446     		mov	r4, r0
 195 0008 B0EE408A 		vmov.f32	s16, s0
 196 000c 0D46     		mov	r5, r1
  81:Core/Src/pid.c **** 
  82:Core/Src/pid.c ****   //	uint32_t time,lasttime;
  83:Core/Src/pid.c **** 	pid->lasttime = pid->thistime;
 197              		.loc 1 83 2 is_stmt 1 view .LVU49
 198              		.loc 1 83 21 is_stmt 0 view .LVU50
 199 000e C36C     		ldr	r3, [r0, #76]
 200              		.loc 1 83 16 view .LVU51
 201 0010 0365     		str	r3, [r0, #80]
  84:Core/Src/pid.c **** 	pid->thistime = HAL_GetTick();
 202              		.loc 1 84 2 is_stmt 1 view .LVU52
 203              		.loc 1 84 18 is_stmt 0 view .LVU53
 204 0012 FFF7FEFF 		bl	HAL_GetTick
ARM GAS  /tmp/ccyOGIX2.s 			page 6


 205              	.LVL8:
 206              		.loc 1 84 16 discriminator 1 view .LVU54
 207 0016 E064     		str	r0, [r4, #76]
  85:Core/Src/pid.c **** 	pid->dtime = pid->thistime-pid->lasttime;
 208              		.loc 1 85 2 is_stmt 1 view .LVU55
 209              		.loc 1 85 32 is_stmt 0 view .LVU56
 210 0018 236D     		ldr	r3, [r4, #80]
 211              		.loc 1 85 28 view .LVU57
 212 001a C01A     		subs	r0, r0, r3
 213              		.loc 1 85 13 view .LVU58
 214 001c 84F85400 		strb	r0, [r4, #84]
  86:Core/Src/pid.c **** 	pid->measure = measure;
 215              		.loc 1 86 2 is_stmt 1 view .LVU59
 216              		.loc 1 86 15 is_stmt 0 view .LVU60
 217 0020 84ED068A 		vstr.32	s16, [r4, #24]
  87:Core/Src/pid.c ****   //	pid->target = target;
  88:Core/Src/pid.c **** 		
  89:Core/Src/pid.c **** 	pid->last_err  = pid->err;
 218              		.loc 1 89 2 is_stmt 1 view .LVU61
 219              		.loc 1 89 22 is_stmt 0 view .LVU62
 220 0024 94ED079A 		vldr.32	s18, [r4, #28]
 221              		.loc 1 89 17 view .LVU63
 222 0028 84ED089A 		vstr.32	s18, [r4, #32]
  90:Core/Src/pid.c **** 	pid->last_output = pid->output;
 223              		.loc 1 90 2 is_stmt 1 view .LVU64
 224              		.loc 1 90 24 is_stmt 0 view .LVU65
 225 002c D4ED0C8A 		vldr.32	s17, [r4, #48]
 226              		.loc 1 90 19 view .LVU66
 227 0030 C4ED0D8A 		vstr.32	s17, [r4, #52]
  91:Core/Src/pid.c **** 	
  92:Core/Src/pid.c **** 	//求差部分
  93:Core/Src/pid.c **** 	if(circle_len == 0)
 228              		.loc 1 93 2 is_stmt 1 view .LVU67
 229              		.loc 1 93 4 is_stmt 0 view .LVU68
 230 0034 002D     		cmp	r5, #0
 231 0036 6ED1     		bne	.L9
  94:Core/Src/pid.c **** 	{
  95:Core/Src/pid.c **** 		pid->err = pid->target - pid->measure;
 232              		.loc 1 95 3 is_stmt 1 view .LVU69
 233              		.loc 1 95 17 is_stmt 0 view .LVU70
 234 0038 D4ED017A 		vldr.32	s15, [r4, #4]
 235              		.loc 1 95 26 view .LVU71
 236 003c 77EEC87A 		vsub.f32	s15, s15, s16
 237              		.loc 1 95 12 view .LVU72
 238 0040 C4ED077A 		vstr.32	s15, [r4, #28]
 239              	.L10:
  96:Core/Src/pid.c **** 	}else{
  97:Core/Src/pid.c **** 		pid->err = circle_err(pid->target, pid->measure, circle_len);
  98:Core/Src/pid.c **** 		//pid->err = pid->target - pid->measure;
  99:Core/Src/pid.c **** 		//printf("measure:%d, target:%d, err:%d\n", (int)pid->measure, (int)pid->target, (int)pid->err);
 100:Core/Src/pid.c **** 	}
 101:Core/Src/pid.c **** 	
 102:Core/Src/pid.c **** 	
 103:Core/Src/pid.c **** 	//是否进入死区
 104:Core/Src/pid.c **** 	if((ABS(pid->err) > pid->DeadBand))
 240              		.loc 1 104 2 is_stmt 1 view .LVU73
 241              		.loc 1 104 6 is_stmt 0 view .LVU74
ARM GAS  /tmp/ccyOGIX2.s 			page 7


 242 0044 94ED077A 		vldr.32	s14, [r4, #28]
 243 0048 B5EEC07A 		vcmpe.f32	s14, #0
 244 004c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 245 0050 75DD     		ble	.L28
 246              		.loc 1 104 6 discriminator 1 view .LVU75
 247 0052 F0EE477A 		vmov.f32	s15, s14
 248              	.L11:
 249              		.loc 1 104 25 discriminator 4 view .LVU76
 250 0056 D4ED106A 		vldr.32	s13, [r4, #64]
 251              		.loc 1 104 4 discriminator 4 view .LVU77
 252 005a F4EEE76A 		vcmpe.f32	s13, s15
 253 005e F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 254 0062 53D5     		bpl	.L12
 105:Core/Src/pid.c **** 	{
 106:Core/Src/pid.c **** 		pid->pout = pid->kp * pid->err;
 255              		.loc 1 106 3 is_stmt 1 view .LVU78
 256              		.loc 1 106 18 is_stmt 0 view .LVU79
 257 0064 D4ED036A 		vldr.32	s13, [r4, #12]
 258              		.loc 1 106 23 view .LVU80
 259 0068 67EE266A 		vmul.f32	s13, s14, s13
 260              		.loc 1 106 13 view .LVU81
 261 006c C4ED096A 		vstr.32	s13, [r4, #36]
 107:Core/Src/pid.c **** 		pid->iout += (pid->ki * pid->err);
 262              		.loc 1 107 3 is_stmt 1 view .LVU82
 263              		.loc 1 107 6 is_stmt 0 view .LVU83
 264 0070 94ED0A6A 		vldr.32	s12, [r4, #40]
 265              		.loc 1 107 20 view .LVU84
 266 0074 D4ED047A 		vldr.32	s15, [r4, #16]
 267              		.loc 1 107 25 view .LVU85
 268 0078 67EE277A 		vmul.f32	s15, s14, s15
 269              		.loc 1 107 13 view .LVU86
 270 007c 36EE276A 		vadd.f32	s12, s12, s15
 271 0080 84ED0A6A 		vstr.32	s12, [r4, #40]
 108:Core/Src/pid.c **** 		
 109:Core/Src/pid.c **** 
 110:Core/Src/pid.c **** 		pid->dout =  pid->kd * (pid->err - pid->last_err); 
 272              		.loc 1 110 3 is_stmt 1 view .LVU87
 273              		.loc 1 110 19 is_stmt 0 view .LVU88
 274 0084 D4ED057A 		vldr.32	s15, [r4, #20]
 275              		.loc 1 110 36 view .LVU89
 276 0088 37EE497A 		vsub.f32	s14, s14, s18
 277              		.loc 1 110 24 view .LVU90
 278 008c 67EE877A 		vmul.f32	s15, s15, s14
 279              		.loc 1 110 13 view .LVU91
 280 0090 C4ED0B7A 		vstr.32	s15, [r4, #44]
 111:Core/Src/pid.c **** 		
 112:Core/Src/pid.c **** 		//积分是否超出限制
 113:Core/Src/pid.c **** 		if(pid->iout > pid->IntegralLimit)
 281              		.loc 1 113 3 is_stmt 1 view .LVU92
 282              		.loc 1 113 21 is_stmt 0 view .LVU93
 283 0094 94ED0F7A 		vldr.32	s14, [r4, #60]
 284              		.loc 1 113 5 view .LVU94
 285 0098 B4EEC76A 		vcmpe.f32	s12, s14
 286 009c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 287 00a0 01DD     		ble	.L14
 114:Core/Src/pid.c **** 			pid->iout = pid->IntegralLimit;
 288              		.loc 1 114 4 is_stmt 1 view .LVU95
ARM GAS  /tmp/ccyOGIX2.s 			page 8


 289              		.loc 1 114 14 is_stmt 0 view .LVU96
 290 00a2 84ED0A7A 		vstr.32	s14, [r4, #40]
 291              	.L14:
 115:Core/Src/pid.c **** 		if(pid->iout < - pid->IntegralLimit)
 292              		.loc 1 115 3 is_stmt 1 view .LVU97
 293              		.loc 1 115 9 is_stmt 0 view .LVU98
 294 00a6 94ED0A6A 		vldr.32	s12, [r4, #40]
 295              		.loc 1 115 18 view .LVU99
 296 00aa B1EE477A 		vneg.f32	s14, s14
 297              		.loc 1 115 5 view .LVU100
 298 00ae B4EEC76A 		vcmpe.f32	s12, s14
 299 00b2 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 300 00b6 01D5     		bpl	.L16
 116:Core/Src/pid.c **** 			pid->iout = - pid->IntegralLimit;
 301              		.loc 1 116 4 is_stmt 1 view .LVU101
 302              		.loc 1 116 14 is_stmt 0 view .LVU102
 303 00b8 84ED0A7A 		vstr.32	s14, [r4, #40]
 304              	.L16:
 117:Core/Src/pid.c **** 		
 118:Core/Src/pid.c **** 		//pid输出和
 119:Core/Src/pid.c **** 		pid->output = pid->pout + pid->iout + pid->dout;
 305              		.loc 1 119 3 is_stmt 1 view .LVU103
 306              		.loc 1 119 32 is_stmt 0 view .LVU104
 307 00bc 94ED0A7A 		vldr.32	s14, [r4, #40]
 308              		.loc 1 119 27 view .LVU105
 309 00c0 76EE876A 		vadd.f32	s13, s13, s14
 310              		.loc 1 119 39 view .LVU106
 311 00c4 77EEA67A 		vadd.f32	s15, s15, s13
 312              		.loc 1 119 15 view .LVU107
 313 00c8 C4ED0C7A 		vstr.32	s15, [r4, #48]
 120:Core/Src/pid.c **** 		
 121:Core/Src/pid.c **** 
 122:Core/Src/pid.c **** 		pid->output = pid->output*0.7f + pid->last_output*0.3f;  //滤波？
 314              		.loc 1 122 3 is_stmt 1 view .LVU108
 315              		.loc 1 122 28 is_stmt 0 view .LVU109
 316 00cc 9FED1D7A 		vldr.32	s14, .L29
 317 00d0 67EE877A 		vmul.f32	s15, s15, s14
 318              		.loc 1 122 52 view .LVU110
 319 00d4 9FED1C7A 		vldr.32	s14, .L29+4
 320 00d8 68EE878A 		vmul.f32	s17, s17, s14
 321              		.loc 1 122 34 view .LVU111
 322 00dc 77EEA87A 		vadd.f32	s15, s15, s17
 323              		.loc 1 122 15 view .LVU112
 324 00e0 C4ED0C7A 		vstr.32	s15, [r4, #48]
 123:Core/Src/pid.c **** 		if(pid->output>pid->MaxOutput)         
 325              		.loc 1 123 3 is_stmt 1 view .LVU113
 326              		.loc 1 123 21 is_stmt 0 view .LVU114
 327 00e4 94ED0E7A 		vldr.32	s14, [r4, #56]
 328              		.loc 1 123 5 view .LVU115
 329 00e8 F4EEC77A 		vcmpe.f32	s15, s14
 330 00ec F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 331 00f0 01DD     		ble	.L18
 124:Core/Src/pid.c **** 		{
 125:Core/Src/pid.c **** 			pid->output = pid->MaxOutput;
 332              		.loc 1 125 4 is_stmt 1 view .LVU116
 333              		.loc 1 125 16 is_stmt 0 view .LVU117
 334 00f2 84ED0C7A 		vstr.32	s14, [r4, #48]
ARM GAS  /tmp/ccyOGIX2.s 			page 9


 335              	.L18:
 126:Core/Src/pid.c **** 		}
 127:Core/Src/pid.c **** 		if(pid->output < -(pid->MaxOutput))
 336              		.loc 1 127 3 is_stmt 1 view .LVU118
 337              		.loc 1 127 9 is_stmt 0 view .LVU119
 338 00f6 D4ED0C7A 		vldr.32	s15, [r4, #48]
 339              		.loc 1 127 20 view .LVU120
 340 00fa B1EE477A 		vneg.f32	s14, s14
 341              		.loc 1 127 5 view .LVU121
 342 00fe F4EEC77A 		vcmpe.f32	s15, s14
 343 0102 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 344 0106 01D5     		bpl	.L12
 128:Core/Src/pid.c **** 		{
 129:Core/Src/pid.c **** 			pid->output = -(pid->MaxOutput);
 345              		.loc 1 129 4 is_stmt 1 view .LVU122
 346              		.loc 1 129 16 is_stmt 0 view .LVU123
 347 0108 84ED0C7A 		vstr.32	s14, [r4, #48]
 348              	.L12:
 130:Core/Src/pid.c **** 		}
 131:Core/Src/pid.c **** 	
 132:Core/Src/pid.c **** 	}
 133:Core/Src/pid.c **** 
 134:Core/Src/pid.c **** 
 135:Core/Src/pid.c **** 	return pid->output;
 349              		.loc 1 135 2 is_stmt 1 view .LVU124
 136:Core/Src/pid.c **** }
 350              		.loc 1 136 1 is_stmt 0 view .LVU125
 351 010c 94ED0C0A 		vldr.32	s0, [r4, #48]
 352 0110 BDEC048B 		vldm	sp!, {d8-d9}
 353              	.LCFI2:
 354              		.cfi_remember_state
 355              		.cfi_restore 82
 356              		.cfi_restore 83
 357              		.cfi_restore 80
 358              		.cfi_restore 81
 359              		.cfi_def_cfa_offset 16
 360              	.LVL9:
 361              		.loc 1 136 1 view .LVU126
 362 0114 38BD     		pop	{r3, r4, r5, pc}
 363              	.LVL10:
 364              	.L9:
 365              	.LCFI3:
 366              		.cfi_restore_state
  97:Core/Src/pid.c **** 		//pid->err = pid->target - pid->measure;
 367              		.loc 1 97 3 is_stmt 1 view .LVU127
  97:Core/Src/pid.c **** 		//pid->err = pid->target - pid->measure;
 368              		.loc 1 97 28 is_stmt 0 view .LVU128
 369 0116 D4ED017A 		vldr.32	s15, [r4, #4]
  97:Core/Src/pid.c **** 		//pid->err = pid->target - pid->measure;
 370              		.loc 1 97 14 view .LVU129
 371 011a 2A46     		mov	r2, r5
 372 011c BDEEC87A 		vcvt.s32.f32	s14, s16
 373 0120 17EE101A 		vmov	r1, s14	@ int
 374 0124 FDEEE77A 		vcvt.s32.f32	s15, s15
 375 0128 17EE900A 		vmov	r0, s15	@ int
 376 012c FFF7FEFF 		bl	circle_err
 377              	.LVL11:
ARM GAS  /tmp/ccyOGIX2.s 			page 10


 378 0130 07EE900A 		vmov	s15, r0	@ int
  97:Core/Src/pid.c **** 		//pid->err = pid->target - pid->measure;
 379              		.loc 1 97 12 discriminator 1 view .LVU130
 380 0134 F8EEE77A 		vcvt.f32.s32	s15, s15
 381 0138 C4ED077A 		vstr.32	s15, [r4, #28]
 382 013c 82E7     		b	.L10
 383              	.L28:
 104:Core/Src/pid.c **** 	{
 384              		.loc 1 104 6 discriminator 2 view .LVU131
 385 013e F1EE477A 		vneg.f32	s15, s14
 386 0142 88E7     		b	.L11
 387              	.L30:
 388              		.align	2
 389              	.L29:
 390 0144 3333333F 		.word	1060320051
 391 0148 9A99993E 		.word	1050253722
 392              		.cfi_endproc
 393              	.LFE133:
 395              		.section	.text.pid_init,"ax",%progbits
 396              		.align	1
 397              		.global	pid_init
 398              		.syntax unified
 399              		.thumb
 400              		.thumb_func
 402              	pid_init:
 403              	.LVL12:
 404              	.LFB134:
 137:Core/Src/pid.c **** 
 138:Core/Src/pid.c **** /*pid结构体初始化，每一个pid参数需要调用一次-----------------------------------------------------*/
 139:Core/Src/pid.c **** void pid_init(PID_TypeDef* pid)
 140:Core/Src/pid.c **** {
 405              		.loc 1 140 1 is_stmt 1 view -0
 406              		.cfi_startproc
 407              		@ args = 0, pretend = 0, frame = 0
 408              		@ frame_needed = 0, uses_anonymous_args = 0
 409              		@ link register save eliminated.
 141:Core/Src/pid.c **** 	pid->f_param_init = pid_param_init;
 410              		.loc 1 141 2 view .LVU133
 411              		.loc 1 141 20 is_stmt 0 view .LVU134
 412 0000 034B     		ldr	r3, .L32
 413 0002 8365     		str	r3, [r0, #88]
 142:Core/Src/pid.c **** 	pid->f_pid_reset = pid_reset;
 414              		.loc 1 142 2 is_stmt 1 view .LVU135
 415              		.loc 1 142 19 is_stmt 0 view .LVU136
 416 0004 034B     		ldr	r3, .L32+4
 417 0006 C365     		str	r3, [r0, #92]
 143:Core/Src/pid.c **** 	pid->f_cal_pid = pid_calculate;
 418              		.loc 1 143 2 is_stmt 1 view .LVU137
 419              		.loc 1 143 17 is_stmt 0 view .LVU138
 420 0008 034B     		ldr	r3, .L32+8
 421 000a 0366     		str	r3, [r0, #96]
 144:Core/Src/pid.c **** }
 422              		.loc 1 144 1 view .LVU139
 423 000c 7047     		bx	lr
 424              	.L33:
 425 000e 00BF     		.align	2
 426              	.L32:
ARM GAS  /tmp/ccyOGIX2.s 			page 11


 427 0010 00000000 		.word	pid_param_init
 428 0014 00000000 		.word	pid_reset
 429 0018 00000000 		.word	pid_calculate
 430              		.cfi_endproc
 431              	.LFE134:
 433              		.global	pid_yaw_speed
 434              		.section	.bss.pid_yaw_speed,"aw",%nobits
 435              		.align	2
 438              	pid_yaw_speed:
 439 0000 00000000 		.space	100
 439      00000000 
 439      00000000 
 439      00000000 
 439      00000000 
 440              		.global	pid_roll_speed
 441              		.section	.bss.pid_roll_speed,"aw",%nobits
 442              		.align	2
 445              	pid_roll_speed:
 446 0000 00000000 		.space	100
 446      00000000 
 446      00000000 
 446      00000000 
 446      00000000 
 447              		.global	pid_roll
 448              		.section	.bss.pid_roll,"aw",%nobits
 449              		.align	2
 452              	pid_roll:
 453 0000 00000000 		.space	100
 453      00000000 
 453      00000000 
 453      00000000 
 453      00000000 
 454              		.global	pid_pithch_speed
 455              		.section	.bss.pid_pithch_speed,"aw",%nobits
 456              		.align	2
 459              	pid_pithch_speed:
 460 0000 00000000 		.space	100
 460      00000000 
 460      00000000 
 460      00000000 
 460      00000000 
 461              		.global	pid_pitch
 462              		.section	.bss.pid_pitch,"aw",%nobits
 463              		.align	2
 466              	pid_pitch:
 467 0000 00000000 		.space	100
 467      00000000 
 467      00000000 
 467      00000000 
 467      00000000 
 468              		.text
 469              	.Letext0:
 470              		.file 2 "/usr/arm-none-eabi/include/machine/_default_types.h"
 471              		.file 3 "/usr/arm-none-eabi/include/sys/_stdint.h"
 472              		.file 4 "Core/Inc/pid.h"
 473              		.file 5 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal.h"
ARM GAS  /tmp/ccyOGIX2.s 			page 12


DEFINED SYMBOLS
                            *ABS*:00000000 pid.c
     /tmp/ccyOGIX2.s:21     .text.pid_param_init:00000000 $t
     /tmp/ccyOGIX2.s:26     .text.pid_param_init:00000000 pid_param_init
     /tmp/ccyOGIX2.s:92     .text.pid_reset:00000000 $t
     /tmp/ccyOGIX2.s:97     .text.pid_reset:00000000 pid_reset
     /tmp/ccyOGIX2.s:120    .text.circle_err:00000000 $t
     /tmp/ccyOGIX2.s:126    .text.circle_err:00000000 circle_err
     /tmp/ccyOGIX2.s:167    .text.pid_calculate:00000000 $t
     /tmp/ccyOGIX2.s:172    .text.pid_calculate:00000000 pid_calculate
     /tmp/ccyOGIX2.s:390    .text.pid_calculate:00000144 $d
     /tmp/ccyOGIX2.s:396    .text.pid_init:00000000 $t
     /tmp/ccyOGIX2.s:402    .text.pid_init:00000000 pid_init
     /tmp/ccyOGIX2.s:427    .text.pid_init:00000010 $d
     /tmp/ccyOGIX2.s:438    .bss.pid_yaw_speed:00000000 pid_yaw_speed
     /tmp/ccyOGIX2.s:435    .bss.pid_yaw_speed:00000000 $d
     /tmp/ccyOGIX2.s:445    .bss.pid_roll_speed:00000000 pid_roll_speed
     /tmp/ccyOGIX2.s:442    .bss.pid_roll_speed:00000000 $d
     /tmp/ccyOGIX2.s:452    .bss.pid_roll:00000000 pid_roll
     /tmp/ccyOGIX2.s:449    .bss.pid_roll:00000000 $d
     /tmp/ccyOGIX2.s:459    .bss.pid_pithch_speed:00000000 pid_pithch_speed
     /tmp/ccyOGIX2.s:456    .bss.pid_pithch_speed:00000000 $d
     /tmp/ccyOGIX2.s:466    .bss.pid_pitch:00000000 pid_pitch
     /tmp/ccyOGIX2.s:463    .bss.pid_pitch:00000000 $d

UNDEFINED SYMBOLS
HAL_GetTick
